{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Artists | Lyrica</title>
  <link rel="stylesheet" href="{% static 'artist.css' %}">
  <style>
   /* Navbar Styles */
.navbar {
        background-color: #007bff;
        padding: 20px;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.5rem;
        font-weight: bold;
        border-radius: 8px;
        margin-bottom: 20px;
      }
.logo-text {
        color: white;
        text-decoration: none;
      }
  </style>
</head>
<body>
  <header class="navbar">
    <div class="navbar-left">
      <a href="{% url 'index' %}" class="logo-text">LyRicA</a>
    </div>
  </header>

  <div class="pixel-window">
    <div class="pixel-header">
      <span class="pixel-title">üéß Artists</span>
    </div>

    <div class="pixel-content">
      <div class="artist-cards-container">
        {% for artist in artists %}
          <div class="artist-card">
            <h2 class="artist-name">{{ artist.name }}</h2>
            <p><strong>Bio:</strong> {{ artist.bio }}</p>
            <p><strong>Followers:</strong> {{ artist.followers }}</p>
            <p><strong>Genre:</strong> {{ artist.genre }}</p>
            <p><strong>Total Streams:</strong> {{ artist.streams }}</p>

            <div class="artist-details">
              <div class="songs-list">
                <h3>Songs:</h3>
                <ul>
                  {% for song in artist.songs %}
                    <li>{{ song.title }} - {{ song.duration }} seconds</li>
                  {% endfor %}
                </ul>
              </div>
              
              <div class="albums-list">
                <h3>Albums:</h3>
                <ul>
                  {% for album in artist.albums %}
                    <li>{{ album.title }} - Released on: {{ album.release_date }}</li>
                  {% endfor %}
                </ul>
              </div>
            </div>

            {% if request.user.user_type.user_type_name == 'User' %}
            {% if artist.is_followed %}
                <button class="unfollow-btn" id="unfollow-btn-{{ artist.id }}" data-artist-id="{{ artist.id }}">Unfollow</button>
                <button class="follow-btn" id="follow-btn-{{ artist.id }}" data-artist-id="{{ artist.id }}" style="display:none">+ Follow</button>
            {% else %}
                <button class="follow-btn" id="follow-btn-{{ artist.id }}" data-artist-id="{{ artist.id }}">+ Follow</button>
                <button class="unfollow-btn" id="unfollow-btn-{{ artist.id }}" data-artist-id="{{ artist.id }}" style="display:none">Unfollow</button>
            {% endif %}
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>

    {% if request.user.user_type.user_type_name == "Admin" %}
      <div class="back-to-dashboard">
        <a href="{% url 'admin_dashboard' %}" class="btn">‚Ü©Ô∏è Back to Dashboard</a>
      </div>
    {% endif %}
  </div>

<script>
    window.onload = function() {
    // Attach event listeners for all follow/unfollow buttons
    const followButtons = document.querySelectorAll('.follow-btn');
    const unfollowButtons = document.querySelectorAll('.unfollow-btn');

    followButtons.forEach(button => {
        button.addEventListener('click', function() {
            const artistId = this.getAttribute('data-artist-id');
            followArtist(artistId);
        });
    });

    unfollowButtons.forEach(button => {
        button.addEventListener('click', function() {
            const artistId = this.getAttribute('data-artist-id');
            unfollowArtist(artistId);
        });
    });
};

function followArtist(artistId) {
    fetch(`/profile/dashboard/artists/follow-artist/${artistId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);  // Show success message
            document.getElementById(`follow-btn-${artistId}`).style.display = 'none';
            document.getElementById(`unfollow-btn-${artistId}`).style.display = 'inline-block';
        } else {
            alert(data.message);  // Show error message
        }
    })
    .catch(error => console.log('Error:', error));
}

function unfollowArtist(artistId) {
    fetch(`/profile/dashboard/artists/unfollow-artist/${artistId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);  // Show success message
            document.getElementById(`unfollow-btn-${artistId}`).style.display = 'none';
            document.getElementById(`follow-btn-${artistId}`).style.display = 'inline-block';
        } else {
            alert(data.message);  // Show error message
        }
    })
    .catch(error => console.log('Error:', error));
}
</script>  
</body>
</html>
